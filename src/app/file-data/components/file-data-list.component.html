<div class="clr-row" *ngIf="files$">
  <div
    *ngFor="let file of files$ | async; let i = index"
    class="clr-align-self-start clr-col-xl-2 clr-col-lg-3 clr-col-md-6 clr-col-sm-12"
  >
    <div (click)="showModal(file)" class="card clickable">
      <div class="card-header">
        <div class="p5" style="margin-top: 0">{{ file.fileName }}</div>
      </div>
      <div class="card-img">
        <img
          class="file-data-img"
          loading="lazy"
          alt="{{ file.fileName }}"
          src="{{ previewUrl(file) }}"
          (load)="imgLoad(file)"
        />
      </div>
      <div class="card-block">
        <div class="card-text file-data-text">
          <div class="p5" *ngIf="options.SHOW_ADDED_ON">Added on: {{ file.createdAt | appDate }}</div>
          <div class="p5" *ngIf="options.SHOW_INDEX_OFF_TOTAL">{{ i + 1 }} / {{ totalElements }}</div>
        </div>
      </div>
    </div>
  </div>
</div>

<clr-modal (clrModalOpenChange)="modalClosed()" [(clrModalOpen)]="openModal" [clrModalSize]="'xl'"
           [clrModalStaticBackdrop]="false" (clrModalOpenChange)="isShown = false">
  <h3 class="modal-title" *ngIf="modalImage">{{ modalImage.fileName }}</h3>
  <div class="modal-body">
    <div class="clr-row">
      <div class="clr-col-xl-7 clr-col-sm-12">
        <img
          class="modal-image"
          *ngIf="modalImage"
          alt="{{ modalImage.fileName }}"
          [lazyLoad] = "previewUrl(modalImage,1080)"
          [defaultImage]="previewUrl(modalImage)"
          style="max-width: 100%"
        />
      </div>
      <div *ngIf="modalMeta$ | async as meta" class="clr-col-xl-5 clr-col-sm-12">
        <div >
          <button (click)="downloadImage()" class="btn btn-info-outline" style='float: right'>
            <cds-icon shape="download"></cds-icon></button>
        </div>
        <div class='row'>

          <table class="table table-compact table-noborder">
            <caption>
              {{modalImage?.fileName}}
            </caption>
            <thead>
              <tr>
                <th class="right">Information</th>
                <th class="left" (click)="isShown =!isShown" style="cursor: pointer">
                  <a *ngIf="!isShown"> Show More</a>
                  <a *ngIf="isShown"> Show Less</a></th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td class="right">Format </td>
                <td class="left">{{getFormat(meta[0])}}</td>
              </tr>
              <tr>
                <td class="right">File Size </td>
                <td class="left">{{modalImage?.sizeBytes | appPrettyBytes}}</td>
              </tr>
              <tr>
                <td class="right">Resolution </td>
                <td class="left">{{getImageGeometry(meta[0])}}</td>
              </tr>
              <tr>
                <td class="right">Date Created  </td>
                <td class="left">{{modalImage?.createdAt | date:'short'}}</td>
              </tr>
              <tr>
                <td class="right">Date Modified  </td>
                <td class="left">{{getModifiedDate(meta[0]) | date:'short'}}</td>
              </tr>

              <tr *ngIf="isShown">
                <td class="right">Date Created  </td>
                <td class="left">{{modalImage?.createdAt | date:'short'}}</td>
              </tr>
              <tr *ngIf="isShown">
                <td class="right">Date Modified  </td>
                <td class="left">{{getModifiedDate(meta[0]) | date:'short'}}</td>
              </tr>


            </tbody>
          </table>
        </div>
      </div>
    </div>
  </div>
</clr-modal>
